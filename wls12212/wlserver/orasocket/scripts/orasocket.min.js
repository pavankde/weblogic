"use strict";var wf={oc:function(e,o){return OraSocketGlobal.FramingUtils.readableOpCode(OraSocketGlobal.FramingUtils.getOpCode(e,o))},dm:function(e,o){return OraSocketGlobal.FramingUtils.displayMask(OraSocketGlobal.FramingUtils.getMaskingKey(e,o))},dh:function(e,o){return OraSocketGlobal.FramingUtils.dumpHeader(e,o)},dp:function(e,o){return OraSocketGlobal.FramingUtils.getUnframedTextData(e,o)}},observe=function(e,o,t){Object.defineProperty(e,o,{get:function(){return this.value},set:function(a){this.value=a,e.changeHandler=t,e.changeHandler(e,o)},enumerable:!0,configurable:!0})},unobserve=function(e,o){delete e.changeHandler,Object.defineProperty(e,o,{get:function(){return this.value},set:function(e){this.value=e},enumerable:!0,configurable:!0})},OraSocketGlobal={debugLevel:0,PING_INTERVAL:25e3,PING_ENABLED:!0,encodingBase:16,ENCODE_FOR_IE_BELOW:10,WEBSOCKET_CREATION_TIMEOUT:1e3,NB_TRY_FOR_EACH_TRANSPORT:2,TRY_AGAIN_INTERVAL:1e4,ENFORCE_ENCODING:!1,CLUSTER_RECONNECTION:"ClusterReconnection",SURFACE_CLUSTER_RECONNECT_CALLBACKS:!1,wsAvailable:!1,flashSupported:!1,xhrAvailable:!1,$nativeWS:{},XHR_UNINITIALIZED:0,XHR_LOADING:1,XHR_RESPONSE_HEADERS_RECEIVED:2,XHR_SOME_RESPONSE_BODY_RECEIVED:3,XHR_REQUEST_COMPLETED:4,HTTP_NO_DATA:0,HTTP_OK:200,HTTP_ERROR_1:403,HTTP_ERROR_2:404,HTTP_SERVER_ERROR:500,HTTP_ERROR_RETRY:503,ERROR_INTERNET_TIMEOUT:12002,ERROR_INTERNET_NAME_NOT_RESOLVED:12007,ERROR_INTERNET_CANNOT_CONNECT:12029,ERROR_INTERNET_CONNECTION_ABORTED:12030,ERROR_INTERNET_CONNECTION_RESET:12031,ERROR_HTTP_INVALID_SERVER_RESPONSE:12152,NATIVE_WEB_SOCKET:"WebSocket",FLASH_SOCKET:"FlashSocket",XML_HTTP_REQUEST:"XMLHttpRequest",CLOSE_CODE_NORMAL:1e3,CLOSE_CODE_GOING_AWAY:1001,CLOSE_CODE_PROTOCOL_ERROR:1002,CLOSE_CODE_CANNOT_ACCEPT_TYPE:1003,CLOSE_CODE_RESERVED:1004,CLOSE_CODE_NO_STATUS:1005,CLOSE_CODE_ABNORMAL:1006,CLOSE_CODE_INCONSISTENT:1007,CLOSE_CODE_POLICY_VIOLATION:1008,CLOSE_CODE_TOO_BIG:1009,CLOSE_CODE_NEGOTIATION_EXPECTED:1010,CLOSE_CODE_UNEXPECTED_CONDITION:1011,CLOSE_CODE_TLS_FAILURE:1015,readableCloseCode:function(e){var o="Reserved or un-managed";switch(e){case OraSocketGlobal.CLOSE_CODE_NORMAL:o="Normal";break;case OraSocketGlobal.CLOSE_CODE_GOING_AWAY:o="Going Away";break;case OraSocketGlobal.CLOSE_CODE_PROTOCOL_ERROR:o="Protocol Error";break;case OraSocketGlobal.CLOSE_CODE_CANNOT_ACCEPT_TYPE:o="Cannot accept type";break;case OraSocketGlobal.CLOSE_CODE_RESERVED:o="Reserved";break;case OraSocketGlobal.CLOSE_CODE_NO_STATUS:o="No Status";break;case OraSocketGlobal.CLOSE_CODE_ABNORMAL:o="Abnormal";break;case OraSocketGlobal.CLOSE_CODE_INCONSISTENT:o="Inconsistent";break;case OraSocketGlobal.CLOSE_CODE_POLICY_VIOLATION:o="Policy Violation";break;case OraSocketGlobal.CLOSE_CODE_TOO_BIG:o="Too Big";break;case OraSocketGlobal.CLOSE_CODE_NEGOTIATION_EXPECTED:o="Negotiation Excpected";break;case OraSocketGlobal.CLOSE_CODE_UNEXPECTED_CONDITION:o="Unexpected Condition";break;case OraSocketGlobal.CLOSE_CODE_TLS_FAILURE:o="TLS Failure";break;default:}return e+"/"+o},fallbackOrder:[],availableTransports:[],clientID:{},clusterID:void 0,clusterReconnectRequest:!1,requestQueue:{},XMLHttpRequest:function(){return new XMLHttpRequest},validateCloseCode:function(e){var o=!0;return"number"!=typeof e||"number"==typeof e&&Math.round(e)!==e?o=!1:1e3!==e&&(3e3>e||e>4999)&&(o=!1),o},validateCloseReason:function(e){var o=!0;return("string"!=typeof e||"string"==typeof e&&e.length>123)&&(o=!1),o},getIEVersion:function(){var e=-1;if("Microsoft Internet Explorer"===navigator.appName){var o=navigator.userAgent,t=RegExp("MSIE ([0-9]{1,}[.0-9]{0,})");null!==t.exec(o)&&(e=parseFloat(RegExp.$1))}return e},isFlashSupported:function(){var e=-1,o="",t=!1;if("undefined"!=typeof ActiveXObject)try{t=!0;var a=new ActiveXObject("ShockwaveFlash.ShockwaveFlash");o=a.GetVariable("$version"),e=parseInt(o.split(" ")[1].split(",")[0],10)}catch(r){t=!1}return navigator.plugins!==void 0&&navigator.plugins["Shockwave Flash"]!==void 0&&(o=navigator.plugins["Shockwave Flash"].description,e=parseInt(o.split(" ")[2],10)),e>=9},Queue:function(){var e=[];this.getSize=function(){return e.length},this.isEmpty=function(){return 0===e.length},this.dequeue=function(){var o=null;return this.isEmpty()||(o=e[0],e.splice(0,1)),o},this.enqueue=function(o){e.push(o)}},FramingUtils:{PAYLOAD_CONTINUES_FROM_LAST:0,UTF_8_DATA:1,BINARY_DATA:2,TERMINATES_CONNECTION:8,PING:9,PONG:10,formatHexa:function(e,o){return OraSocketGlobal.FramingUtils.lpad(e,o,"0")},lpad:function(e,o,t){for(var a=e;o>a.length;)a=t+a;return a},getFin:function(e,o){return void 0===o&&(o=0),255&(128&e[o+0])>>>7},getOpCode:function(e,o){return void 0===o&&(o=0),255&(15&e[o+0])},getMask:function(e,o){return void 0===o&&(o=0),255&(128&e[o+1])>>>7},getPayloadOffset:function(e,o){void 0===o&&(o=0);var t=2,a=127&e[o+1],r=OraSocketGlobal.FramingUtils.getMask(e,o);return 126===a?t+=2:127===a&&(t+=8),1===r&&(t+=4),t},getMaskOffset:function(e,o){void 0===o&&(o=0);var t=2,a=127&e[o+1];return 126===a?t+=2:127===a&&(t+=8),t},getPayloadLength:function(e,o){void 0===o&&(o=0);var t=127&e[o+1];if(126===t){var a=e[o+2],r=e[o+3];t=a<<8|r}else if(127===t){var a=e[o+2],r=e[o+3],n=e[o+4],l=e[o+5],c=e[o+6],s=e[o+7],i=e[o+8],O=e[o+9],S=OraSocketGlobal.FramingUtils.formatHexa(a.toString(16),2)+OraSocketGlobal.FramingUtils.formatHexa(r.toString(16),2)+OraSocketGlobal.FramingUtils.formatHexa(n.toString(16),2)+OraSocketGlobal.FramingUtils.formatHexa(l.toString(16),2)+OraSocketGlobal.FramingUtils.formatHexa(c.toString(16),2)+OraSocketGlobal.FramingUtils.formatHexa(s.toString(16),2)+OraSocketGlobal.FramingUtils.formatHexa(i.toString(16),2)+OraSocketGlobal.FramingUtils.formatHexa(O.toString(16),2);OraSocketGlobal.debugLevel>4&&console.debug("0x"+S),t=parseInt(S,16)}return t},getMaskingKey:function(e,o){void 0===o&&(o=0);var t=OraSocketGlobal.FramingUtils.getMaskOffset(e,o),a=e[t+o],r=e[t+o+1],n=e[t+o+2],l=e[t+o+3];if(OraSocketGlobal.debugLevel>100){var c="0x"+OraSocketGlobal.FramingUtils.formatHexa(a.toString(16),2)+" 0x"+OraSocketGlobal.FramingUtils.formatHexa(r.toString(16),2)+" 0x"+OraSocketGlobal.FramingUtils.formatHexa(n.toString(16),2)+" 0x"+OraSocketGlobal.FramingUtils.formatHexa(l.toString(16),2);console.debug("Mask : "+c)}return[a,r,n,l]},dumpHeader:function(e,o){for(var t=OraSocketGlobal.FramingUtils.getPayloadOffset(e,o),a="",r=0;t>r;r++)a+="["+OraSocketGlobal.FramingUtils.formatHexa(e[o+r].toString(16),2)+"] ";return a},getFrameLength:function(e,o){void 0===o&&(o=0);var t=OraSocketGlobal.FramingUtils.getPayloadOffset(e,o),a=OraSocketGlobal.FramingUtils.getPayloadLength(e,o);return t+a},displayMask:function(e){for(var o="",t=0;e.length>t;t++)o+="0x"+OraSocketGlobal.FramingUtils.formatHexa(e[t].toString(16),2)+" ";return o},readableOpCode:function(e){var o;switch(e){case OraSocketGlobal.FramingUtils.PAYLOAD_CONTINUES_FROM_LAST:o="Payload continues";break;case OraSocketGlobal.FramingUtils.UTF_8_DATA:o="UTF8 data";break;case OraSocketGlobal.FramingUtils.BINARY_DATA:o="Binary data";break;case OraSocketGlobal.FramingUtils.TERMINATES_CONNECTION:o="Connection terminated";break;case OraSocketGlobal.FramingUtils.PING:o="Ping";break;case OraSocketGlobal.FramingUtils.PONG:o="Pong";break;default:o="Unkonwn opcode [0x"+e.toString(16)+"]"}return o},generateMask:function(){for(var e=[16,32,48,64],o=0;4>o;o++)e[o]=Math.floor(128*Math.random());return e},frameMessage:function(e,o,t,a){void 0!==e.length&&e.length>0&&OraSocketGlobal.debugLevel>1&&console.debug("Message to Frame:["+e+"]"),"number"==typeof e&&(e=""+e);var r="string"!=typeof e?void 0!==e.size?e.size:e.byteLength:e.length;void 0===t&&r>0&&(t=1),void 0===t&&0===r&&(t=0),void 0===a&&(a=1);var n=[0,0,0,0];1===t&&r>0&&(n=OraSocketGlobal.FramingUtils.generateMask()),r>0&&OraSocketGlobal.debugLevel>1&&console.debug("Message length:"+r+" :"+e);var l=[],c=a<<7|o;if(l.push(c),126>r)c=t<<7|127&r,l.push(c);else if(65535>r){var s=(65280&r)>>8,i=255&r;l.push(126|t<<7),l.push(s),l.push(i)}else{var O=OraSocketGlobal.FramingUtils.formatHexa(r.toString(16),16);l.push(127|t<<7);for(var S=0;O.length>S;S+=2){var b=O.substring(S,S+2);l.push(parseInt(b,16))}}for(var S=0;1===t&&n.length>S;S++)l.push(n[S]);var u,E,g=l;"string"!=typeof e?(E=void 0!==e.size?e.size:e.byteLength,u=new Uint8Array(e)):E=e.length;for(var S=0;E>S;S++){var d="string"!=typeof e?u[S]:e.charCodeAt(S);g.push(d^n[S%4])}if(r>0&&OraSocketGlobal.debugLevel>4){for(var k="",S=0;g.length>S;S++)k+="["+OraSocketGlobal.FramingUtils.formatHexa(g[S].toString(16),2)+"] ";console.debug("Framed ("+g.length+") :"+k)}return g},unframedMessage:function(e,o){void 0===o&&(o=0);var t=[0,0,0,0];1===OraSocketGlobal.FramingUtils.getMask(e)&&(t=OraSocketGlobal.FramingUtils.getMaskingKey(e,o));for(var a=[],r=o+OraSocketGlobal.FramingUtils.getPayloadOffset(e,o),n=r+OraSocketGlobal.FramingUtils.getPayloadLength(e,o),l=r;n>l;l++){var c=e[l]^t[(l-r)%4];a.push(c)}return a},getUnframedTextData:function(e,o){var t="";if(void 0===o&&(o=0),OraSocketGlobal.FramingUtils.getOpCode(e,o)===OraSocketGlobal.FramingUtils.UTF_8_DATA){var a=[0,0,0,0];1===OraSocketGlobal.FramingUtils.getMask(e)&&(a=OraSocketGlobal.FramingUtils.getMaskingKey(e,o));for(var r=o+OraSocketGlobal.FramingUtils.getPayloadOffset(e,o),n=r+OraSocketGlobal.FramingUtils.getPayloadLength(e,o),l=r;n>l;l++){var c=e[l]^a[(l-r)%4];t+=String.fromCharCode(c)}}return t},binaryString:function(e){var o=e.length,t=new Uint8Array(o);try{for(var a=0;o>a;a++)t[a]=255&e[a]}catch(r){console.log(r)}return t.buffer},string2ArrayBuffer:function(e){for(var o=[],t=0;e.length>t;t++)o.push(255&e.charCodeAt(t));return o},binJson2ArrayBuffer_v1:function(e){for(var o=[],t=e.split(";"),a=0;t.length>a;a++)t[a].length>0&&o.push(255&parseInt("0x"+t[a]));return o}},GnlUtils:{base16decode:function(e){for(var o=[],t=0;e.length>t;t+=2){var a=e.substring(t,t+2);o.push(255&parseInt("0x"+a))}return o},base16encode:function(e){for(var o="",t=0;e.length>t;t++)o+="string"==typeof e?OraSocketGlobal.FramingUtils.formatHexa(e.charCodeAt(t).toString(16),2):OraSocketGlobal.FramingUtils.formatHexa(e[t].toString(16),2);return o},base64:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",base64encode:function(e){for(var o,t,a,r=OraSocketGlobal.GnlUtils.base64,n=[],l=0;e.length>l;){"string"==typeof e?(o=e.charCodeAt(l++),t=e.charCodeAt(l++),a=e.charCodeAt(l++)):(o=e[l++],t=e[l++],a=e[l++]);var c=(o<<16)+((t||0)<<8)+(a||0),s=(c&63<<18)>>18,i=(258048&c)>>12,O=isNaN(t)?64:(4032&c)>>6,S=isNaN(a)?64:63&c;n[n.length]=r.charAt(s),n[n.length]=r.charAt(i),n[n.length]=r.charAt(O),n[n.length]=r.charAt(S)}return n.join("")},base64decode:function(e){var o=OraSocketGlobal.GnlUtils.base64,t={strlen:0!==e.length%4,chars:RegExp("[^"+o+"]").test(e),equals:/=/.test(e)&&(/=[^=]/.test(e)||/={3}/.test(e))};if(t.strlen||t.chars||t.equals)throw Error("Invalid base64 data");for(var a=[],r=0;e.length>r;){var n=o.indexOf(e.charAt(r++)),l=o.indexOf(e.charAt(r++)),c=o.indexOf(e.charAt(r++)),s=o.indexOf(e.charAt(r++)),i=(n<<18)+(l<<12)+((63&c)<<6)+(63&s),O=(i&255<<16)>>16,S=64===c?-1:(65280&i)>>8,b=64===s?-1:255&i;a[a.length]=String.fromCharCode(O),S>=0&&(a[a.length]=String.fromCharCode(S)),b>=0&&(a[a.length]=String.fromCharCode(b))}return a.join("")},decodeReadyState:function(e){var o="unknown";switch(e){case OraSocketGlobal.XHR_UNINITIALIZED:o="UNINITIALIZED";break;case OraSocketGlobal.XHR_LOADING:o="LOADING";break;case OraSocketGlobal.XHR_RESPONSE_HEADERS_RECEIVED:o="RESPONSE HEADERS RECEIVED";break;case OraSocketGlobal.XHR_SOME_RESPONSE_BODY_RECEIVED:o="SOME RESPONSE BODY RECEIVED";break;case OraSocketGlobal.XHR_REQUEST_COMPLETED:o="REQUEST COMPLETED";break;default:o="unknown"}return o},decodeStatus:function(e){var o="unknown";try{switch(e){case OraSocketGlobal.HTTP_NO_DATA:o="NO DATA/"+(""+e);break;case OraSocketGlobal.HTTP_OK:o="OK/"+(""+e);break;case OraSocketGlobal.HTTP_ERROR_1:o="ERROR/"+(""+e);break;case OraSocketGlobal.HTTP_ERROR_2:o="ERROR/"+(""+e);break;case OraSocketGlobal.HTTP_ERROR_RETRY:o="ERROR RETRY/"+(""+e);break;case OraSocketGlobal.ERROR_INTERNET_TIMEOUT:o="ERROR_INTERNET_TIMEOUT/"+(""+e);break;case OraSocketGlobal.ERROR_INTERNET_NAME_NOT_RESOLVED:o="ERROR_INTERNET_NAME_NOT_RESOLVED/"+(""+e);break;case OraSocketGlobal.ERROR_INTERNET_CANNOT_CONNECT:o="ERROR_INTERNET_CANNOT_CONNECT/"+(""+e);break;case OraSocketGlobal.ERROR_INTERNET_CONNECTION_ABORTED:o="ERROR_INTERNET_CONNECTION_ABORTED/"+(""+e);break;case OraSocketGlobal.ERROR_INTERNET_CONNECTION_RESET:o="ERROR_INTERNET_CONNECTION_RESET/"+(""+e);break;case OraSocketGlobal.ERROR_HTTP_INVALID_SERVER_RESPONSE:o="ERROR_HTTP_INVALID_SERVER_RESPONSE/"+(""+e);break;default:o=""+e}}catch(t){}return o},getClass:function(e){if(e&&"object"==typeof e&&"[object Array]"!==Object.prototype.toString.call(e)&&e.constructor){var o=(""+e.constructor).match(/function\s*(\w+)/);if(o&&2===o.length)return o[1]}return!1},processAsUInt8Array:function(e,o,t){var a;if(window.Blob&&e instanceof Blob){var r=new FileReader;r.onload=function(){var e=this.result;a=new Uint8Array(e),o(a)},setTimeout(function(){r.readAsArrayBuffer(e)},0)}else!window.Blob&&e instanceof Array?(a=e,o(a)):e instanceof Uint8Array?(a=e,o(a)):window.ArrayBuffer&&e instanceof ArrayBuffer||!window.ArrayBuffer&&"string"!=typeof e?(a=new Uint8Array(e),o(a)):t?t():console.log("Don't know what to do with this payload ["+e+"]")}},baseXXencode:function(e){if(16===OraSocketGlobal.encodingBase)return OraSocketGlobal.GnlUtils.base16encode(e);if(64===OraSocketGlobal.encodingBase)return OraSocketGlobal.GnlUtils.base64encode(e);throw Error("Unsupported encoding")},baseXXdecode:function(e){if(16===OraSocketGlobal.encodingBase)return OraSocketGlobal.FramingUtils.binaryString(OraSocketGlobal.GnlUtils.base16decode(e));if(64===OraSocketGlobal.encodingBase)return OraSocketGlobal.GnlUtils.base64decode(e);throw Error("Unsupported encoding")}},OraSocket={ORASOCKET_PATH:"scripts/orasocket.js",ORASOCKET_MIN_PATH:"scripts/orasocket.min.js",baseUrl:".",enforcedTransport:"",configure:function(e){void 0!==e.baseUrl&&(OraSocket.baseUrl=e.baseUrl),void 0!==e.PING_INTERVAL&&(OraSocketGlobal.PING_INTERVAL=e.PING_INTERVAL),void 0!==e.ENCODE_FOR_IE_BELOW&&(OraSocketGlobal.ENCODE_FOR_IE_BELOW=e.ENCODE_FOR_IE_BELOW),void 0!==e.WEBSOCKET_CREATION_TIMEOUT&&(OraSocketGlobal.WEBSOCKET_CREATION_TIMEOUT=e.WEBSOCKET_CREATION_TIMEOUT),void 0!==e.NB_TRY_FOR_EACH_TRANSPORT&&(OraSocketGlobal.NB_TRY_FOR_EACH_TRANSPORT=e.NB_TRY_FOR_EACH_TRANSPORT),void 0!==e.TRY_AGAIN_INTERVAL&&(OraSocketGlobal.TRY_AGAIN_INTERVAL=e.TRY_AGAIN_INTERVAL),void 0!==e.SERVER_PING_ENABLED&&(OraSocketGlobal.PING_ENABLED=e.SERVER_PING_ENABLED),void 0!==e.ENFORCE_ENCODING&&(OraSocketGlobal.ENFORCE_ENCODING=e.ENFORCE_ENCODING),void 0!==e.debug&&(OraSocketGlobal.debugLevel=e.debug),void 0!==e.transport&&(OraSocket.enforcedTransport=e.transport),void 0!==e.SURFACE_CLUSTER_RECONNECT_CALLBACKS&&(OraSocketGlobal.SURFACE_CLUSTER_RECONNECT_CALLBACKS=e.SURFACE_CLUSTER_RECONNECT_CALLBACKS)},displayConfig:function(){console.log("Base URL                              :"+OraSocket.baseUrl),console.log("Ping interval                         :"+OraSocketGlobal.PING_INTERVAL+" ms"),console.log("Encoding required for IE below version:"+OraSocketGlobal.ENCODE_FOR_IE_BELOW),console.log("WebSocket creation timeout            :"+OraSocketGlobal.WEBSOCKET_CREATION_TIMEOUT+" ms"),console.log("Nb try for each transport             :"+OraSocketGlobal.NB_TRY_FOR_EACH_TRANSPORT+" time(s)"),console.log("Try-again interval                    :"+OraSocketGlobal.TRY_AGAIN_INTERVAL+" ms"),console.log("Ping enabled                          :"+OraSocketGlobal.PING_ENABLED),console.log("Enforce encoding                      :"+OraSocketGlobal.ENFORCE_ENCODING),console.log("Debug level                           :"+OraSocketGlobal.debugLevel),console.log("Enforced transport                    :"+(void 0!==OraSocket.enforcedTransport&&OraSocket.enforcedTransport.length>0?OraSocket.enforcedTransport:"none")),console.log("Surface Cluster Connect Callbacks     :"+OraSocketGlobal.SURFACE_CLUSTER_RECONNECT_CALLBACKS)}},RequestParameter={names:{WS_ATTEMPT:"tyrus-ws-attempt",REQUIRE_ENCODING:"tyrus-encoding-required",CLIENT_OPERATION:"tyrus-client-operation",CLIENT_ID:"tyrus-connection-id",CLIENT_TRANSPORT:"tyrus-client-transport",CORS_REQUIRED:"tyrus-cors-headers",SUB_PROTOCOLS:"tyrus-sub-protocol",CLUSTER_CONNECTION_ID:"tyrus-cluster-connection-id",UNIQUE_REQ_ID:"unique-req-id",CHAR_ENCODED:"char-encoded"},values:{WS_HAND_SHAKE:"Hand-Shake",NONE:"none",BASE_16:"base16",BASE_64:"base64"}},WSOperation={WAIT_FOR_INPUT:"tyrus-wait-for-input",SEND_MESSAGE:"tyrus-send-message"},SUPPORTED_TRANSPORTS="tyrus-fallback-transports",MAY_ADD_WS_HEADER="tyrus-may-add-ws-transports",getScriptPath=function(e){var o=OraSocket.baseUrl;return e.startsWith("/")&&o.endsWith("/")?o=o+"."+e:e.startsWith("/")||o.endsWith("/")?o+=e:o=o+"/"+e,OraSocketGlobal.debugLevel>10&&console.log("["+e+"] becomes\n["+o+"] with\n["+OraSocket.baseUrl+"]"),o},getScriptPathFromDOM=function(){var e="";if(void 0!==document.head){for(var o=document.head.getElementsByTagName("script"),t=0;o.length>t;t++)if(void 0!==o[t].src){if(o[t].src.endsWith(OraSocket.ORASOCKET_PATH)){var a=o[t].src;e=a.substring(0,a.length-OraSocket.ORASOCKET_PATH.length);break}if(o[t].src.endsWith(OraSocket.ORASOCKET_MIN_PATH)){var a=o[t].src;e=a.substring(0,a.length-OraSocket.ORASOCKET_MIN_PATH.length);break}}}else for(var o=document.getElementsByTagName("head")[0].getElementsByTagName("script"),t=0;o.length>t;t++)if(void 0!==o[t].src){if(o[t].src.endsWith(OraSocket.ORASOCKET_PATH)){var a=o[t].src;e=a.substring(0,a.length-OraSocket.ORASOCKET_PATH.length);break}if(o[t].src.endsWith(OraSocket.ORASOCKET_MIN_PATH)){var a=o[t].src;e=a.substring(0,a.length-OraSocket.ORASOCKET_MIN_PATH.length);break}}return e},importScript=function(e,o){var t=document.createElement("script"),a=getScriptPath(e);if(t.readyState?t.onreadystatechange=function(){("loaded"===t.readyState||"complete"===t.readyState)&&(t.onreadystatechange=null,OraSocketGlobal.debugLevel>2&&console.log(a+" loaded."),o&&(o(),OraSocketGlobal.debugLevel>2&&console.log("Callback after "+a+" completed.")))}:(t.onload=function(){OraSocketGlobal.debugLevel>10&&console.log(a+" loaded."),o&&(o(),OraSocketGlobal.debugLevel>10&&console.log("Callback after "+a+" completed."))},t.onerror=function(e){console.log(""+e)}),t.src=a,t.type="text/javascript",void 0!==document.head){for(var r=document.head.getElementsByTagName("script"),n=0;r.length>n;n++)if(void 0!==r[n].src&&r[n].src.endsWith(e)){document.head.removeChild(r[n]);break}document.head.appendChild(t)}else{for(var r=document.getElementsByTagName("head")[0].getElementsByTagName("script"),n=0;r.length>n;n++)if(void 0!==r[n].src&&r[n].src.endsWith(e)){console.log("--- Removing "+e+", already there."),document.getElementsByTagName("head")[0].removeChild(r[n]);break}document.getElementsByTagName("head")[0].appendChild(t)}},loadJSON=function(e){var o;try{o=loadJSONFile(getScriptPath(e),"application/json")}catch(t){var a=OraSocket.baseUrl;OraSocket.configure({baseUrl:getScriptPathFromDOM()});try{o=loadJSONFile(getScriptPath(e),"application/json"),console.log("Enforced baseUrl to ["+OraSocket.baseUrl+"], was ["+a+"]")}catch(t){alert("Cannot find "+e+"\nTried:\n - "+a+"\n - "+OraSocket.baseUrl)}}return JSON.parse(o)},loadJSONFile=function(e,o){var t=new XMLHttpRequest;if(t.open("GET",e,!1),null!==o&&void 0!==o&&t.overrideMimeType&&t.overrideMimeType(o),t.send(),t.status===OraSocketGlobal.HTTP_OK)return t.responseText;if(t.status===OraSocketGlobal.HTTP_SERVER_ERROR||t.status===OraSocketGlobal.HTTP_ERROR_2)throw{err:"Not Found"};return null},orasocketInit=function(){"function"!=typeof String.prototype.startsWith&&(String.prototype.startsWith=function(e){return 0===this.indexOf(e)}),"function"!=typeof String.prototype.endsWith&&(String.prototype.endsWith=function(e){return-1!==this.indexOf(e,this.length-e.length)}),OraSocketGlobal.wsAvailable=window.WebSocket||window.MozWebSocket,OraSocketGlobal.wsAvailable,OraSocketGlobal.$nativeWS=window.WebSocket,window.MozWebSocket&&(void 0!==OraSocketGlobal&&OraSocketGlobal.debugLevel>5&&console.log("-- Using MozWebSocket."),OraSocketGlobal.$nativeWS=window.MozWebSocket),OraSocketGlobal.xhrAvailable=window.XMLHttpRequest,OraSocketGlobal.flashSupported=OraSocketGlobal.isFlashSupported();var e=!1,o=!0;if((void 0===window.console||void 0===window.console.log||void 0===window.console.debug||void 0===window.console.warn)&&((void 0===window.console||void 0===window.console.log)&&(console={},console.log=e||o?function(t){e&&alert(t),o&&(void 0!==window.status?window.status=t:alert("window.status not available (display your status bar...), switching to alert.\n"+t))}:function(){}),(void 0===window.console.debug||void 0===window.console.warn)&&(void 0!==OraSocketGlobal&&OraSocketGlobal.debugLevel>5&&console.log("Redifining console.warn & console.debug."),console.warn=console.log,console.debug=console.log)),void 0===window.Uint8Array){var t=function(e,o){return this.slice(e,o)},a=function(e,o){2>arguments.length&&(o=0);for(var t=0,a=e.length;a>t;++t,++o)this[o]=255&e[t]},r=function(e){var o;if("number"==typeof e){o=Array(e);for(var r=0;e>r;++r)o[r]=0}else o=e.slice(0);return o.subarray=t,o.buffer=o,o.byteLength=o.length,o.set=a,"object"==typeof e&&e.buffer&&(o.buffer=e.buffer),o};window.Uint8Array=r,window.Uint32Array=r,window.Int32Array=r}OraSocketGlobal.fallbackOrder=[OraSocketGlobal.NATIVE_WEB_SOCKET,OraSocketGlobal.FLASH_SOCKET,OraSocketGlobal.XML_HTTP_REQUEST],OraSocketGlobal.requestQueue=new OraSocketGlobal.Queue};(function(){orasocketInit()})();var WebSocket=function(e){this.protocol="",this.extensions="",this.bufferedAmount=0,this.readyState=0,this.binaryType="";var o,t,a,r,n,l,c,s=e,i=this;this.setDebugLevel=function(e){OraSocketGlobal.debugLevel=e};var O={};this.getConstructorOptions=function(){return O},this.getServerURI=function(){return s};var S=function(){g({err:OraSocketGlobal.CLUSTER_RECONNECTION})};this.getConnectionTrialStatus=function(){return c},this.setConnectionTrialStatus=function(e){c=e};for(var b,u,E=function(){var e=(new Date).getTime();if(void 0!==c)if(void 0!==i.getTransport()&&c.transport===i.getTransport()){var o=e-c.timestamp;void 0!==OraSocketGlobal&&OraSocketGlobal.debugLevel>10&&console.debug("... Connection ("+i.getTransport()+") re-requested after "+o+" ms ("+OraSocketGlobal.TRY_AGAIN_INTERVAL+"). nbshot="+c.nbshot),OraSocketGlobal.TRY_AGAIN_INTERVAL>o?c.nbshot++:c.nbshot=1,c.actual++,void 0!==OraSocketGlobal&&OraSocketGlobal.debugLevel>5&&console.log(" ... In manageDynamicFallbackStatus, actual is now "+c.actual),c.timestamp=e}else c.timestamp=e;else c={transport:void 0!==i.getTransport()?i.getTransport():"WebSocket",timestamp:e,nbshot:1,actual:1},void 0!==OraSocketGlobal&&OraSocketGlobal.debugLevel>5&&console.log(" ... In manageDynamicFallbackStatus (init), actual is now "+c.actual)},g=function(e){OraSocketGlobal.debugLevel>10&&console.debug("Transport is (was) "+i.getTransport()+" -> "+JSON.stringify(e));for(var o=-1,t=0;OraSocketGlobal.fallbackOrder.length>t;t++)if(OraSocketGlobal.fallbackOrder[t]===i.getTransport()){o=t;break}if(o>-1){if(OraSocketGlobal.fallbackOrder.length>o){var a=0,r=!0;void 0!==c?a=c.nbshot<=OraSocketGlobal.NB_TRY_FOR_EACH_TRANSPORT?0:1:console.warn(".....................connectionTrialStatus is not defined (weird).");var n=OraSocketGlobal.fallbackOrder[o+a];if(void 0===n&&(n="no more.",r=!1),e.err!==OraSocketGlobal.CLUSTER_RECONNECTION&&!OraSocketGlobal.SURFACE_CLUSTER_RECONNECT_CALLBACKS){var l=i.getTransport()+" transport just failed ["+e.err+"] ("+(""+c.nbshot)+" time"+(c.nbshot>1?"s":"")+(c.actual===c.nbshot?"":", actually "+(""+c.actual))+"), "+(0===a?"retrying (after "+((new Date).getTime()-c.timestamp)/1e3+" s)":"trying "+n);i.onerror({err:l})}if(r){a>0&&(c.nbshot=1,c.transport=n,i.setTransport(n));var s=i.getConstructorOptions();s.transport=n;var O,S,b=!1,u=function(e){b?e("WebSocket ("+n+") re-created Ok"):(e("WebSocket ("+n+") NOT re-created within timeout..."),clearTimeout(S),g({err:"Creation timeout ["+OraSocketGlobal.WEBSOCKET_CREATION_TIMEOUT+" ms], at "+(""+(new Date).getTime())}))},E=function(o,t){o("... Re-creating WebSocket (from worker)");try{try{e.err===OraSocketGlobal.CLUSTER_RECONNECTION&&console.log(">>> DEBUG >>> Cluster reconnection: quit."),i.quit()}catch(a){console.warn("Quit errored:"+JSON.stringify(a))}e.err===OraSocketGlobal.CLUSTER_RECONNECTION?N(i.url.replace(/ws:/i,"http:")):f(),b=!0,clearTimeout(O),o("WebSocket re-created successfully with transport "+i.getTransport()),t(i)}catch(a){o(" ---> Error re-creating WebSocket:"+JSON.stringify(a))}},d=function(e,o,t,a,r){O=setTimeout(function(){o(a)},t),S=setTimeout(function(){e(a,r)},0)},k=function(e){OraSocketGlobal.debugLevel>10&&console.log(e)},T=function(){OraSocketGlobal.debugLevel>5&&console.debug("  Created in time. (onSuccess)")};d(E,u,OraSocketGlobal.WEBSOCKET_CREATION_TIMEOUT,k,T),void 0!==s.debug&&i.setDebugLevel(s.debug)}else i.onerror({err:"All transport options exhausted. You are not connected to the server."}),i.onclose()}}else i.onerror({err:"Current transport NOT FOUND in the available transport list"})},d=0;arguments.length>d;d++)if(d>0)if("string"==typeof arguments[d])u=[arguments[d]];else if(void 0!==Array.isArray&&Array.isArray(arguments[d])||void 0===Array.isArray&&arguments[d]instanceof Array){if(u=arguments[d],u.length>1){for(var k=!1,T="",_=0;u.length-1>_;_++){for(var R=_+1;u.length>R;R++)if(u[_]===u[R]){k=!0,T="SubProtocol ["+u[R]+"] duplicated";break}if(k)break}if(k)throw new SyntaxError(T)}}else"object"==typeof arguments[d]&&(OraSocket.configure(arguments[d]),void 0!==OraSocket.enforcedTransport&&OraSocket.enforcedTransport.length>0&&(b=OraSocket.enforcedTransport,o=b),O=arguments[d]);OraSocketGlobal.debugLevel>1&&console.debug("WebSocket constructor invoked, transport is "+b),this.onmessage=function(e){console.log("Default onMessage:"),console.log(e)},this.onopen=function(){console.log("*** Default onopen")},this.onclose=function(){},this.onerror=function(){},this.send=function(){},OraSocketGlobal.debugLevel>10&&(console.debug("Your browser "+(OraSocketGlobal.wsAvailable?"supports":"doesn't support")+" WebSockets."),console.debug("Your browser "+(OraSocketGlobal.flashSupported?"supports":"doesn't support")+" Flash."),console.debug("Your browser "+(OraSocketGlobal.xhrAvailable?"supports":"doesn't support")+" XMLHttpRequest."));var f=function(){OraSocketGlobal.debugLevel>10&&console.debug("Loading prototype functions..."),o===OraSocketGlobal.NATIVE_WEB_SOCKET?importScript("scripts/transports/native/NativeWebSocket.js",function(){var e="ws"+a+"://"+r+":"+n+"/"+l;void 0!==OraSocketGlobal.clusterID&&(e+="?"+RequestParameter.names.CLUSTER_CONNECTION_ID+"="+OraSocketGlobal.clusterID,OraSocketGlobal.debugLevel>10&&console.log(">>> DEBUG >>> Cluster (native) reconnection: "+e));var o=new NativeWebSocket(OraSocketGlobal.$nativeWS,e,u);void 0!==OraSocketGlobal&&OraSocketGlobal.debugLevel>5&&console.log(" ... Invoking manageDynamicFallbackStatus from NativeWebSocket"),E(),o.onclose=function(e){void 0!==OraSocketGlobal.clusterID&&void 0!==e&&e.code===OraSocketGlobal.CLOSE_CODE_ABNORMAL?(OraSocketGlobal.clusterReconnectRequest=!0,S(),OraSocketGlobal.SURFACE_CLUSTER_RECONNECT_CALLBACKS&&i.onclose(e)):(OraSocketGlobal.clusterReconnectRequest=!1,i.onclose(e))},o.onopen=i.onopen,o.onerror=function(e){g(e)},o.onmessage=i.onmessage,i.send=o.send,i.close=function(e,t){i.readyState=NativeWebSocketStatic.WebSocketReadyState.CLOSING,o.close(e,t),i.readyState=NativeWebSocketStatic.WebSocketReadyState.CLOSED},i.quit=function(){o.quit()},i.protocol=o.getProtocol(),i.binaryType=o.binaryType,i.readyState=o.getReadyState(),OraSocketGlobal.debugLevel>5&&console.debug("End of Native WebSocket callback, invoking onopen"),setTimeout(function(){i.readyState=NativeWebSocketStatic.WebSocketReadyState.OPEN,i.protocol=o.getProtocol(),(!OraSocketGlobal.clusterReconnectRequest||OraSocketGlobal.SURFACE_CLUSTER_RECONNECT_CALLBACKS)&&i.onopen()},50)}):o===OraSocketGlobal.FLASH_SOCKET?(console.log("FLASH: Work in progress"),importScript("scripts/transports/native/flash/FlashWebSocket.js",function(){var e=new FlashWebSocket("ws"+a+"://"+r+":"+n+"/"+l,u);void 0!==OraSocketGlobal&&OraSocketGlobal.debugLevel>5&&console.log(" ... Invoking manageDynamicFallbackStatus from FlashWebSocket"),E(),e.onopen=i.onopen,e.onclose=i.onclose,e.onerror=function(e){g(e)},e.onmessage=i.onmessage,i.send=e.send,i.close=function(o,t){i.readyState=FlashWebSocket.CLOSING,e.close(o,t),i.readyState=FlashWebSocket.CLOSED},i.quit=function(){e.quit()};try{i.protocol=e.getProtocol()}catch(o){}try{i.binaryType=e.binaryType}catch(o){}try{i.readyState=e.getReadyState()}catch(o){}OraSocketGlobal.debugLevel>5&&console.debug("End of Flash WebSocket callback, invoking onopen"),setTimeout(function(){i.readyState=FlashWebSocket.OPEN;try{i.protocol=e.getProtocol()}catch(o){}},50)})):o===OraSocketGlobal.XML_HTTP_REQUEST?importScript("scripts/transports/http/xhr/LongPoll.js",function(){var e=new LongPoll(OraSocketGlobal.clientID,"http"+a+"://"+r+":"+n+"/"+l,u),o=!0;void 0!==OraSocketGlobal&&OraSocketGlobal.debugLevel>5&&console.log(" ... Invoking manageDynamicFallbackStatus from LongPoll"),E(),e.onopen=i.onopen,e.onclose=i.onclose,e.onerror=function(e){g(e)},e.onmessage=i.onmessage,i.send=e.send,i.close=function(t,a){o||(i.readyState=LongPollStatic.CLOSING),e.close(t,a),o||(i.readyState=LongPollStatic.CLOSED)},i.quit=function(){e.quit()},i.protocol=e.protocol,i.binaryType=e.binaryType;var t=function(o,t){o===e&&(void 0!==OraSocketGlobal&&OraSocketGlobal.debugLevel>5&&console.log("A property ("+t+") changed on LongPoll Emulation"),"readyState"===t?(void 0!==OraSocketGlobal&&OraSocketGlobal.debugLevel>5&&console.log("Its readyState property changed, now "+o.readyState),i.readyState=e.readyState):"protocol"===t&&(void 0!==OraSocketGlobal&&OraSocketGlobal.debugLevel>5&&console.log("Its protocol property changed, now "+o.protocol),i.protocol=e.protocol))};try{observe(e,"readyState",t.bind(this)),observe(e,"protocol",t.bind(this))}catch(c){console.log("Observing WebSocket..."),o=!1}OraSocketGlobal.debugLevel>5&&console.debug("End of XHR callback, invoking onopen"),setTimeout(function(){i.readyState=LongPollStatic.OPEN,void 0!==e.getProtocol()&&e.getProtocol().length>0&&(i.protocol=e.getProtocol()),i.onopen()},50)}):OraSocketGlobal.debugLevel>0&&(console.warn("Unmanaged transport:"+o),alert("Unmanaged transport:"+o)),i.url=i.URL=e,i.getTransport=function(){return o},i.setTransport=function(e){o=e},i.onInitCompleted=function(e){console.log("WebSocket.onInitCompleted:"+e)},OraSocketGlobal.debugLevel>10&&console.debug("... Prototype functions loaded.")},N=function(e){OraSocketGlobal.debugLevel>10&&console.debug("Sending first (POST) request (handshake) to "+e+"..."+(void 0!==b?", enforcing "+b:""));var t=new OraSocketGlobal.XMLHttpRequest,a=!1;t.onreadystatechange=function(){if(t.readyState===OraSocketGlobal.XHR_REQUEST_COMPLETED&&t.status===OraSocketGlobal.HTTP_OK){var e=t.getAllResponseHeaders();OraSocketGlobal.debugLevel>10&&console.debug("All headers:\n"+e);var r=t.getResponseHeader(SUPPORTED_TRANSPORTS);OraSocketGlobal.debugLevel>10&&console.debug("Fallback Transports:"+r);var n=r.split(","),l=!1,c=t.getResponseHeader(MAY_ADD_WS_HEADER);if("NO"!==c){for(var s="NO"!==c,i=0;s&&n.length>i;i++)if(n[i]===OraSocketGlobal.NATIVE_WEB_SOCKET){l=!0;break}!l&&s&&n.splice(0,0,OraSocketGlobal.NATIVE_WEB_SOCKET)}OraSocketGlobal.availableTransports=n;for(var i=0;n.length>i;i++){if(OraSocketGlobal.wsAvailable&&n[i]===OraSocketGlobal.NATIVE_WEB_SOCKET&&(void 0===b||void 0!==b&&b===OraSocketGlobal.NATIVE_WEB_SOCKET)){o=n[i];break}if(OraSocketGlobal.xhrAvailable&&n[i]===OraSocketGlobal.XML_HTTP_REQUEST&&(void 0===b||void 0!==b&&b===OraSocketGlobal.XML_HTTP_REQUEST)){o=n[i];break}}void 0===o||0===o.length?(console.warn("No available transport can be used..."),alert("No available transport can be used...")):OraSocketGlobal.debugLevel>10&&console.debug("Preferred transport is "+o),"{}"===JSON.stringify(OraSocketGlobal.clientID)&&(OraSocketGlobal.clientID=t.getResponseHeader(RequestParameter.names.CLIENT_ID)),OraSocketGlobal.debugLevel>10&&console.debug("Client ID:"+OraSocketGlobal.clientID);
var O=t.getResponseHeader(RequestParameter.names.CLUSTER_CONNECTION_ID);void 0!==O&&null!==O?(OraSocketGlobal.clusterID=O,OraSocketGlobal.debugLevel>=0&&console.debug("Cluster Connection ID:"+OraSocketGlobal.clusterID)):OraSocketGlobal.clusterID=void 0,a=!0,f()}},e=e.replace("localhost","127.0.0.1"),OraSocketGlobal.debugLevel>10&&console.debug("First POST request (handshake) to:"+e),t.open("POST",e,!1);try{if(t.setRequestHeader(RequestParameter.names.WS_ATTEMPT,RequestParameter.values.WS_HAND_SHAKE),void 0!==OraSocketGlobal.clusterID&&(t.setRequestHeader(RequestParameter.names.CLUSTER_CONNECTION_ID,OraSocketGlobal.clusterID),OraSocketGlobal.debugLevel>10&&console.debug(">>> DEBUG >>> Attempting cluster re-connection ["+OraSocketGlobal.clusterID+"] with URI ["+e+"]")),void 0!==u){var r="";if("string"==typeof u)r=u;else if(Array.isArray(u))for(var n=0;u.length>n;n++)r+=(r.length>0?", ":"")+u[n];t.setRequestHeader("tyrus-sub-protocol",r)}}catch(l){console.warn(""+l)}try{t.send(),a=!0}catch(l){var c=void 0!==l.stack?l.stack:JSON.stringify(l);throw console.warn("First POST (aka HandShake):"+c),i.onerror(l),l}};OraSocketGlobal.debugLevel>10&&console.debug("Parsing server URI: ["+e+"]");var v=RegExp("^(http|ws)(.?):[/]{2}([^/|^:]*):?(\\d*)/(.*)"),C=v.exec(e);try{t=C[1],a=C[2],r=C[3],n=C[4],l=C[5],(null===n||0===n.length)&&(n="80")}catch(p){OraSocketGlobal.debugLevel>10&&console.debug("Error parsing server URI: ["+e+"]:"+p)}var h=""+t+a;if("WS"!==h.toUpperCase()&&"WSS"!==h.toUpperCase())throw new SyntaxError("The URL's scheme must be either 'ws' or 'wss'. 'http' is not allowed.");if(e.indexOf("#")>-1){var G="Failed to construct 'WebSocket': The URL contains a fragment identifier ('fragment'). Fragment identifiers are not allowed in WebSocket URLs.";throw new SyntaxError(G)}N("http"+a+"://"+r+":"+n+"/"+l),OraSocketGlobal.debugLevel>20&&console.log("Hand Shake with ["+e+"] completed.")};